//====================================== 客户端 WebView 推荐使用参数 ======================================
// 开启  	                                                                         推荐	                  理由	                                            潜在影响
"--disable-gpu"	                                                                // ✅ 推荐	     降低 GPU 活动，节省功耗（尤其适合静态页面）	        会影响 WebGL、Canvas 渲染性能，某些页面可能变卡
"--disable-site-isolation-trials"	                                            // ✅ 推荐	     减少多进程分离带来的资源开销	                    安全隔离性略下降，影响不大
"--disable-shared-workers"	                                                    // ✅ 推荐	     避免 Web Worker 常驻线程消耗	                    某些应用如 WebIM、后台通信可能会失败
// 不开启
"--disable-renderer-backgrounding"	                                            // ⚠️ 按需	     禁用后台渲染降优先级，保持活跃响应	                会持续占用资源和电量，适用于需要后台实时更新的场景
"--disable-features=AudioServiceOutOfProcess,IsolateOrigins,site-per-process"   // ⚠️ 谨慎使用	 减少子进程，提高整合度；可能降功耗	                降低安全性、影响复杂页面兼容性
"--disable-dev-shm-usage"	                                                    // ⚠️ 一般不推荐	 用于共享内存不可靠的环境（如容器）	                桌面环境一般无影响，禁用可能反而增加内存开销
"--disable-software-rasterizer"	                                                // ❌ 不推荐	     若 GPU 被禁用，此项关闭会导致无法回退至 CPU 渲染	    页面会显示异常甚至渲染失败（白屏）
"--disable-backgrounding-occluded-windows"	                                    // ❌ 不推荐	     正常被遮挡的窗口应当节能处理	                    阻止系统节电优化，增加整体功耗


//====================================== 托盘时代码使用示例 ======================================
// 推荐的 WebView2 启动参数配置（分类注释说明），跟踪实际行为：启动 WebView2 时加上 --enable-logging=stderr --v=1，可以监控是否参数生效。
// 微软参数文档：https://learn.microsoft.com/en-us/microsoft-edge/webview2/concepts/webview-features-flags?tabs=dotnetcsharp
// Chrome 文档：https://peter.sh/experiments/chromium-command-line-switches/
// 
// 测试效果，内存降低数据：
// FloatingMenu1.exe   179328K →  177236K
// WebView2            100MB →  65MB

var arguments = string.Join(" ", new[]
{
    "--disable-gpu",                                                               // 禁用 GPU 进程（减小显存使用）
    "--disable-software-rasterizer",                                               // 禁用软件渲染器，避免 CPU 开销
    "--disable-renderer-backgrounding",                                            // 阻止后台窗口渲染进程降低优先级, 不休眠，避免频繁激活/销毁
    "--disable-backgrounding-occluded-windows",                                    // 相似功能，被遮挡的窗口也不降优先级，防止性能抖动
    "--disable-features=AudioServiceOutOfProcess,IsolateOrigins,site-per-process", // 关闭音频与站点隔离进程
    "--disable-site-isolation-trials",                                             // 禁用站点隔离（WebView2 特有标志）
    "--disable-shared-workers",                                                    // 禁用 SharedWorker 进程
    "--disable-dev-shm-usage",                                                     // 减少共享内存使用（尤其于容器/低资源环境）

    // ✅ 推荐用于内存优化
    //"--disable-gpu",                              // 禁用 GPU 加速（减小显存使用）
    //"--disable-software-rasterizer",              // 禁用软件光栅器，避免 CPU 开销
    //"--disable-renderer-backgrounding",           // 后台渲染线程不休眠，避免频繁激活/销毁
    //"--disable-backgrounding-occluded-windows",   // 被遮挡的窗口也不降优先级，防止性能抖动

    //// ✅ 推荐用于内存优化（取舍平衡）
    //"--disable-features=AudioServiceOutOfProcess,IsolateOrigins,site-per-process",
    //"--AudioServiceOutOfProcess",                 // 关闭可节省独立音频进程内存
    //"--IsolateOrigins, site-per-process",         // 每域/站点独立进程，禁用后可减少内存和进程数量

    //⚠️ 不推荐用于生产环境，仅调试或特定场景使用
    //"--no-sandbox",                              // 禁用沙箱（仅调试使用，生产应移除）

    //⚠️ 调试用途（开发中可启用）
    //"--auto-open-devtools-for-tabs"              // 启动时自动打开开发者工具
  });

var options = new CoreWebView2EnvironmentOptions
{
    AdditionalBrowserArguments = arguments
};

var env = await CoreWebView2Environment.CreateAsync(null, userDataFolder, options);
await webView.EnsureCoreWebView2Async(env);
				
				





